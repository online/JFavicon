/* 
 * JFavicon - A small library for manipulating the Favicon
 * Str@nnik
 * Copyright (c) 2012 Alex Ivashkin
 * @version 0.3.3 min
*/

(function(){var a={m:{},sett:{width:15,height:9,bg:"#000",ct:"#fff",num:null,favicon:"/favicon.ico",currStyle:"default",dir:"/",font:"normal 8px sans-serif",sMes:!1,mes:"\u041d\u043e\u0432\u044b\u0445: {c}"}},f=function(){var a=navigator.userAgent.toLowerCase();return function(e){return-1!==a.indexOf(e)}}();a.sett.brow=f("safari")?"saf":f("msie")?"ie":!1;a.init=function(b){a.m.body=document.getElementsByTagName("body")[0];a.m.head=document.getElementsByTagName("head")[0];a.m.fav=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0];a.m.setTitle=document.getElementsByTagName("title")[0];a.m.title=document.title;if("undefined"!=typeof b&&(b.extract&&(window.jf=a),b.fav&&(a.sett.favicon=b.fav),b.style&&(a.sett.currStyle=b.style),b.dir&&(a.sett.dir=b.dir),b.width&&(a.sett.width=b.width),b.height&&(a.sett.height=b.height),b.bg&&(a.sett.bg=b.bg),b.ct&&(a.sett.ct=b.ct),b.num&&(a.sett.num=b.num),b.font&&(a.sett.font=b.font),b.message&&(a.sett.mes=b.message),b.showMessage))a.sett.sMes=b.showMessage;document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]?a.m.fvi=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]:(b=document.createElement("link"),b.rel="shortcut icon",b.href=a.sett.favicon,b.type="image/x-icon",a.m.head.appendChild(b),a.m.fvi=b);return this};a.style={"default":{title:"default",maxNum:99},main:{title:"main",maxNum:2,ext:".png",pref:"fv"}};a.setStyle=function(b){if("undefined"!=typeof b&&"undefined"==typeof a.style[b.title])return a.style[b.title]=b,this};a.draw=function(b){if("default"==a.sett.currStyle){var e=new Image;e.src=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0].href;var f=function(){if(a.sett.sMes||"ie"==a.sett.brow||"saf"==a.sett.brow){var d=a.sett.mes.replace("{c}",b).replace("{s}",a.m.title);a.m.setTitle.innerHTML=d}};e.onload=function(){var d=document.createElement("canvas");d.width=16;d.height=16;var c=d.getContext("2d");c.drawImage(e,0,0);c.fillStyle=a.sett.bg;c.fillRect(1,16-a.sett.height,a.sett.width,a.sett.height);c.fillStyle=a.sett.ct;c.font=a.sett.font;c.fillText(99>=b?b:"99+",2,14);a.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);c=document.createElement("link");c.rel="shortcut icon";c.href=d.toDataURL();c.type="image/x-icon";a.m.head.appendChild(c);f()}}else{a.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);var g=document.createElement("link");g.rel="shortcut icon";var h=null;b<=a.style[a.sett.currStyle].maxNum?h=b:h="max";g.href=a.sett.dir+a.sett.currStyle+"/"+a.style[a.sett.currStyle].pref+h+a.style[a.sett.currStyle].ext;g.type="image/x-icon";a.m.head.appendChild(g);f()}a.sett.num=b;return this};a.add=function(b){"undefined"==typeof b&&(b=1);a.draw(a.sett.num+b);return this};a.deduct=function(b){"undefined"==typeof b&&(b=1);a.draw(a.sett.num-b);return this};a.disable=function(){a.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);var b=document.createElement("link");b.rel="shortcut icon";b.href=a.m.fvi.href;b.type="image/x-icon";a.m.head.appendChild(b);if(a.sett.sMes||"ie"==a.sett.brow||"saf"==a.sett.brow)a.m.setTitle.innerHTML=a.m.title;return this};a.reset=function(){a.disable();var b=a.sett.num;a.sett.num=null;if(a.sett.sMes||"ie"==a.sett.brow||"saf"==a.sett.brow)a.m.setTitle.innerHTML=a.m.title;return b};window.JFavicon=a})();