/* 
 * JFavicon - A small library for manipulating the Favicon
 * Str@nnik
 * Copyright (c) 2012 Alex Ivashkin
 * @version 0.2.9 min
*/

(function(){var b={m:{},sett:{width:15,height:9,bg:"#000",ct:"#fff",num:null,favicon:"/favicon.ico",currStyle:"default",dir:"/",font:"normal 8px sans-serif"},init:function(a){b.m.body=document.getElementsByTagName("body")[0];b.m.head=document.getElementsByTagName("head")[0];b.m.fav=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0];b.m.title=document.getElementsByTagName("title")[0];if("undefined"!=typeof a&&(a.extract&&(window.jf=b),a.fav&&(b.sett.favicon=a.fav),a.style&&(b.sett.currStyle=a.style),a.dir&&(b.sett.dir=a.dir),a.width&&(b.sett.width=a.width),a.height&&(b.sett.height=a.height),a.bg&&(b.sett.bg=a.bg),a.ct&&(b.sett.ct=a.ct),a.num&&(b.sett.num=a.num),a.font))b.sett.font=a.font;document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]?b.m.fvi=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]:(a=document.createElement("link"),a.rel="shortcut icon",a.href=b.sett.favicon,a.type="image/x-icon",b.m.head.appendChild(a),b.m.fvi=a);return this},style:{"default":{title:"default",maxNum:99},main:{title:"main",maxNum:2,ext:".png",pref:"fv"}},setStyle:function(a){"undefined"!=typeof a&&"undefined"==typeof b.style[a.title]&&(b.style[a.title]=a)},draw:function(a){if("default"==b.sett.currStyle){var e=new Image;e.src=document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0].href;e.onload=function(){var d=document.createElement("canvas");d.width=16;d.height=16;var c=d.getContext("2d");c.drawImage(e,0,0);c.fillStyle=b.sett.bg;c.fillRect(1,16-b.sett.height,b.sett.width,b.sett.height);c.fillStyle=b.sett.ct;c.font=b.sett.font;c.fillText(99>=a?a:"99+",2,14);b.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);c=document.createElement("link");c.rel="shortcut icon";c.href=d.toDataURL();c.type="image/x-icon";b.m.head.appendChild(c)}}else{b.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);var d=document.createElement("link");d.rel="shortcut icon";var f=null;a<=b.style[b.sett.currStyle].maxNum?f=a:f="max";d.href=b.sett.dir+b.sett.currStyle+"/"+b.style[b.sett.currStyle].pref+f+b.style[b.sett.currStyle].ext;d.type="image/x-icon";b.m.head.appendChild(d)}b.sett.num=a;return this},add:function(a){"undefined"==typeof a&&(a=1);b.draw(b.sett.num+a)},deduct:function(a){"undefined"==typeof a&&(a=1);b.draw(b.sett.num-a)},disable:function(){b.m.head.removeChild(document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]')[0]);var a=document.createElement("link");a.rel="shortcut icon";a.href=b.m.fvi.href;a.type="image/x-icon";b.m.head.appendChild(a)},reset:function(){b.disable();b.sett.num=null}};window.JFavicon=b})();